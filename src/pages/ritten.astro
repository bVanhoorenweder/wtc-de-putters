---
import BaseLayout from '../layouts/BaseLayout.astro';
import Hero from '../components/Hero.astro';
import RitCard from '../components/RitCard.astro';
import { ritten, getAllGroups, getDistanceCategories, getTypes } from '../data/ritten';

const groups = getAllGroups();
const distanceCategories = getDistanceCategories();
const types = getTypes();
---

<BaseLayout title="Ritten - WTC De Putters">
  <!-- Hero Section -->
  <Hero
    title="Onze Ritten"
    subtitle="Download GPX-bestanden en verken de mooiste routes met je groep"
    variant="default"
  />

  <!-- Ritten Section -->
  <section class="section-padding bg-putters-gray-bg" data-cue="fadeIn">
    <div class="container mx-auto px-4">
      <!-- Filters -->
      <div class="flex flex-wrap justify-center gap-3 mb-4">
        <button
          class="filter-btn distance-filter active px-5 py-2 rounded-lg font-semibold transition-colors duration-300 bg-putters-primary text-white"
          data-filter="all"
        >
          Alle Afstanden
        </button>
        {distanceCategories.map(category => (
          <button
            class="filter-btn distance-filter px-5 py-2 rounded-lg font-semibold transition-colors duration-300 bg-white text-putters-text shadow-sm hover:bg-putters-primary hover:text-white"
            data-filter={`distance-${category.min}-${category.max}`}
          >
            {category.label}
          </button>
        ))}
      </div>
      <div class="flex flex-wrap justify-center gap-3 mb-12">
        <button
          class="filter-btn type-filter active px-5 py-2 rounded-lg font-semibold transition-colors duration-300 bg-putters-primary text-white"
          data-filter="all"
        >
          Alle Types
        </button>
        {types.map(type => (
          <button
            class="filter-btn type-filter px-5 py-2 rounded-lg font-semibold transition-colors duration-300 bg-white text-putters-text shadow-sm hover:bg-putters-primary hover:text-white"
            data-filter={`type-${type}`}
          >
            {type}
          </button>
        ))}
      </div>

      <!-- Ritten Grid -->
      <div class="max-w-7xl mx-auto">
        <div id="ritten-grid" class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
          {ritten.map((rit, index) => (
            <div
              class="rit-item h-full"
              data-groups={rit.groups.join(',')}
              data-distance={rit.distance}
              data-type={rit.type}
              data-cue="slideInUp"
              data-cue-delay={index * 100}
            >
              <RitCard rit={rit} />
            </div>
          ))}
        </div>

        <!-- No Results Message -->
        <div id="no-results" class="hidden text-center py-16">
          <div class="text-6xl mb-4">üîç</div>
          <h3 class="text-2xl font-heading font-bold text-putters-heading mb-3">
            Geen ritten gevonden
          </h3>
          <p class="text-putters-text">
            Probeer een andere filtercombinatie
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- Download Info Section -->
  <section class="section-padding bg-white" data-cue="fadeIn">
    <div class="container mx-auto px-4">
      <div class="max-w-4xl mx-auto">
        <h2 class="section-title">Hoe GPX-bestanden gebruiken?</h2>

        <div class="grid md:grid-cols-3 gap-8">
          <!-- Step 1 -->
          <div class="text-center p-8 bg-putters-gray-bg rounded-lg shadow-md" data-cue="slideInUp">
            <div class="w-20 h-20 mx-auto mb-4 bg-gradient-to-br from-putters-primary to-green-500 text-white rounded-full flex items-center justify-center text-3xl font-heading font-bold">
              1
            </div>
            <h3 class="font-heading font-bold text-putters-heading mb-3 text-lg">
              Download GPX
            </h3>
            <p class="text-putters-text text-sm">
              Klik op de download knop bij de gewenste rit om het GPX-bestand op te slaan
            </p>
          </div>

          <!-- Step 2 -->
          <div class="text-center p-8 bg-putters-gray-bg rounded-lg shadow-md" data-cue="slideInUp" data-cue-delay="100">
            <div class="w-20 h-20 mx-auto mb-4 bg-gradient-to-br from-putters-secondary to-pink-500 text-white rounded-full flex items-center justify-center text-3xl font-heading font-bold">
              2
            </div>
            <h3 class="font-heading font-bold text-putters-heading mb-3 text-lg">
              Upload naar Device
            </h3>
            <p class="text-putters-text text-sm">
              Importeer het bestand in je Garmin, Wahoo of andere fietscomputer
            </p>
          </div>

          <!-- Step 3 -->
          <div class="text-center p-8 bg-putters-gray-bg rounded-lg shadow-md" data-cue="slideInUp" data-cue-delay="200">
            <div class="w-20 h-20 mx-auto mb-4 bg-gradient-to-br from-putters-blue to-blue-500 text-white rounded-full flex items-center justify-center text-3xl font-heading font-bold">
              3
            </div>
            <h3 class="font-heading font-bold text-putters-heading mb-3 text-lg">
              Start je Rit
            </h3>
            <p class="text-putters-text text-sm">
              Volg de route op je device en geniet van een vlotte rit met de club
            </p>
          </div>
        </div>

        <!-- Additional Info -->
        <div class="mt-12 bg-putters-gray-bg p-6 rounded-lg shadow-md">
          <h4 class="font-heading font-bold text-putters-heading mb-3 flex items-center gap-2">
            <span class="text-2xl">üí°</span>
            Tips voor GPX-gebruik
          </h4>
          <ul class="space-y-2 text-putters-text text-sm">
            <li class="flex items-start gap-2">
              <span class="text-putters-secondary font-bold">‚úì</span>
              <span>Controleer altijd de batterij van je fietscomputer voor een lange rit</span>
            </li>
            <li class="flex items-start gap-2">
              <span class="text-putters-secondary font-bold">‚úì</span>
              <span>Download de route thuis via wifi om data te besparen</span>
            </li>
            <li class="flex items-start gap-2">
              <span class="text-putters-secondary font-bold">‚úì</span>
              <span>Heb je geen GPX-compatibel toestel? Volg gewoon de groep!</span>
            </li>
            <li class="flex items-start gap-2">
              <span class="text-putters-secondary font-bold">‚úì</span>
              <span>Voor Garmin Connect links: sync automatisch naar je Garmin toestel</span>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </section>

  <!-- CTA Section -->
  <section class="py-16 bg-putters-gray-bg">
    <div class="container mx-auto px-4">
      <div class="max-w-4xl mx-auto text-center bg-gradient-to-br from-putters-primary to-putters-blue text-white rounded-2xl p-12">
        <h3 class="text-4xl font-heading font-bold mb-6">Rijd mee met WTC De Putters!</h3>
        <p class="text-xl mb-8 opacity-90">
          Word lid en ontdek wekelijks nieuwe routes met gelijkgestemde wielrenners
        </p>
        <div class="flex flex-col sm:flex-row gap-4 justify-center">
          <a
            href="/lid-worden"
            class="px-10 py-4 bg-white text-putters-primary rounded-full font-heading font-bold text-lg hover:shadow-xl transition-all duration-300 hover:scale-105"
          >
            Word Lid
          </a>
          <a
            href="/groepen"
            class="px-10 py-4 bg-transparent border-2 border-white text-white rounded-full font-heading font-bold text-lg hover:bg-white hover:text-putters-primary transition-all duration-300"
          >
            Bekijk Groepen
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- Initialize ScrollCue -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // @ts-ignore
      if (typeof scrollCue !== 'undefined') {
        // @ts-ignore
        scrollCue.init({
          duration: 600,
          interval: -0.7,
          percentage: 0.8
        });
      }
    });
  </script>

  <!-- Filtering Script -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      let activeDistanceFilter = 'all';
      let activeTypeFilter = 'all';

      const ritItems = document.querySelectorAll('.rit-item');
      const noResults = document.getElementById('no-results');

      function filterRitten() {
        let visibleCount = 0;

        ritItems.forEach((item) => {
          const distance = parseInt(item.getAttribute('data-distance') || '0');
          const type = item.getAttribute('data-type') || '';

          // Check distance filter
          let distanceMatch = true;
          if (activeDistanceFilter !== 'all') {
            const [min, max] = activeDistanceFilter.replace('distance-', '').split('-').map(Number);
            distanceMatch = distance >= min && distance <= max;
          }

          // Check type filter
          const typeMatch = activeTypeFilter === 'all' || type === activeTypeFilter.replace('type-', '');

          // Show/hide item
          if (distanceMatch && typeMatch) {
            (item as HTMLElement).style.display = 'block';
            visibleCount++;
          } else {
            (item as HTMLElement).style.display = 'none';
          }
        });

        // Show/hide no results message
        if (noResults) {
          noResults.classList.toggle('hidden', visibleCount > 0);
        }
      }

      // Distance filter buttons
      document.querySelectorAll('.distance-filter').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const target = e.currentTarget as HTMLElement;
          document.querySelectorAll('.distance-filter').forEach(b => {
            b.classList.remove('active', 'bg-putters-primary', 'text-white');
            b.classList.add('bg-white', 'text-putters-text', 'shadow-sm');
          });
          target.classList.add('active', 'bg-putters-primary', 'text-white');
          target.classList.remove('bg-white', 'text-putters-text', 'shadow-sm');

          activeDistanceFilter = target.getAttribute('data-filter') || 'all';
          filterRitten();
        });
      });

      // Type filter buttons
      document.querySelectorAll('.type-filter').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const target = e.currentTarget as HTMLElement;
          document.querySelectorAll('.type-filter').forEach(b => {
            b.classList.remove('active', 'bg-putters-primary', 'text-white');
            b.classList.add('bg-white', 'text-putters-text', 'shadow-sm');
          });
          target.classList.add('active', 'bg-putters-primary', 'text-white');
          target.classList.remove('bg-white', 'text-putters-text', 'shadow-sm');

          activeTypeFilter = target.getAttribute('data-filter') || 'all';
          filterRitten();
        });
      });
    });
  </script>
</BaseLayout>